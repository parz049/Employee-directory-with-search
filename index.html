<!DOCTYPE html>
<html ng-app="employeeApp">
<head>
  <meta charset="UTF-8" />
  <title>Employee Directory</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body ng-controller="MainController">

  <div class="employee-container">
    <h1>Employee Directory</h1>
    <button class="logout-btn" ng-click="logout()">Logout</button>

    <input
      type="search"
      ng-model="searchQuery"
      ng-change="searchEmployees()"
      placeholder="Search by name, email, or department..."
      class="search-box"
    />

    <form ng-submit="addEmployee()" class="add-form">
      <input type="text" ng-model="newEmployee.name" placeholder="Name" required />
      <input type="email" ng-model="newEmployee.email" placeholder="Email" required />
      <input type="text" ng-model="newEmployee.department" placeholder="Department" required />
      <button type="submit">Add Employee</button>
    </form>

    <table ng-if="employees.length > 0" class="employee-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Department</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="emp in employees track by emp.id">
          <td>{{ emp.name }}</td>
          <td>{{ emp.email }}</td>
          <td>{{ emp.department }}</td>
          <td><button class="delete-btn" ng-click="deleteEmployee(emp.id)">Delete</button></td>
        </tr>
      </tbody>
    </table>

    <p ng-if="employees.length === 0" class="no-data">No employees found.</p>
  </div>

  <script>
    angular.module('employeeApp', [])
      .controller('MainController', ['$scope', '$http', function($scope, $http) {
        const API = 'http://localhost:3000';

        $scope.employees = [];
        $scope.newEmployee = {};
        $scope.searchQuery = '';

        $scope.loadEmployees = function(search = '') {
          let url = `${API}/employees`;
          if (search.trim() !== '') {
            url += `?search=${encodeURIComponent(search.trim())}`;
          }
          $http.get(url).then(response => {
            $scope.employees = response.data;
          }, error => {
            alert('Error loading employees: ' + error.statusText);
          });
        };

        $scope.addEmployee = function() {
          if (!$scope.newEmployee.name || !$scope.newEmployee.email || !$scope.newEmployee.department) {
            alert('Please fill all fields.');
            return;
          }
          $http.post(`${API}/employees`, $scope.newEmployee).then(response => {
            $scope.newEmployee = {};
            $scope.loadEmployees($scope.searchQuery);
          }, error => {
            alert('Error adding employee: ' + (error.data?.error || error.statusText));
          });
        };

        $scope.deleteEmployee = function(id) {
          if (!confirm('Are you sure you want to delete this employee?')) return;
          $http.delete(`${API}/employees/${id}`).then(response => {
            $scope.loadEmployees($scope.searchQuery);
          }, error => {
            alert('Error deleting employee: ' + error.statusText);
          });
        };

        $scope.searchEmployees = function() {
          $scope.loadEmployees($scope.searchQuery);
        };

        $scope.logout = function() {
          window.location.href = 'signin.html';
        };

        // Initial load
        $scope.loadEmployees();
      }]);
  </script>

</body>
</html>
